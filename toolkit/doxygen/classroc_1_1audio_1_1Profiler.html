<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Roc Toolkit internal modules: roc::audio::Profiler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script src="/analytics.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon80.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Roc Toolkit internal modules
   </div>
   <div id="projectbrief">Roc Toolkit: real-time audio streaming</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classroc_1_1audio_1_1Profiler.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classroc_1_1audio_1_1Profiler-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">roc::audio::Profiler Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classroc_1_1audio_1_1Profiler.html" title="Profiler The role of the profiler is to report the average processing speed (# of samples processed p...">Profiler</a> The role of the profiler is to report the average processing speed (# of samples processed per time unit) during the last N seconds. We want to calculate the average processing speed efficiently (with O(1) complexity, without allocations, and as lightweight as possible). The problems with this are that we have variable-sized frames and SMA requires fixed-size chunks. To efficiently perform this calculation a ring buffer is employed. The idea behind the ring buffer is that each chunk of the buffer is the average speed of 10ms worth of samples. The ring buffer is initialized with fixed size (N * 1000)ms / (10ms) chunks. Within each chunk a weighted mean is used to calculate the average speed during those 10ms. Each frame will contribute a different number of samples to each chunk, the chunk speed is then weighted based on how many samples are contributed at what frame speed. As the chunks get populated the moving average is calculated. When the buffer is not entirely full the cumulative moving average algorithm is used and once the buffer is full the simple moving average algorithm is used.  
 <a href="classroc_1_1audio_1_1Profiler.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="profiler_8h_source.html">profiler.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for roc::audio::Profiler:</div>
<div class="dyncontent">
<div class="center"><img src="classroc_1_1audio_1_1Profiler__inherit__graph.png" border="0" usemap="#aroc_1_1audio_1_1Profiler_inherit__map" alt="Inheritance graph"/></div>
<map name="aroc_1_1audio_1_1Profiler_inherit__map" id="aroc_1_1audio_1_1Profiler_inherit__map">
<area shape="rect" title="Profiler The role of the profiler is to report the average processing speed (# of samples processed p..." alt="" coords="41,80,181,107"/>
<area shape="rect" href="classroc_1_1core_1_1NonCopyable.html" title="Base class for non&#45;copyable objects." alt="" coords="5,5,216,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for roc::audio::Profiler:</div>
<div class="dyncontent">
<div class="center"><img src="classroc_1_1audio_1_1Profiler__coll__graph.png" border="0" usemap="#aroc_1_1audio_1_1Profiler_coll__map" alt="Collaboration graph"/></div>
<map name="aroc_1_1audio_1_1Profiler_coll__map" id="aroc_1_1audio_1_1Profiler_coll__map">
<area shape="rect" title="Profiler The role of the profiler is to report the average processing speed (# of samples processed p..." alt="" coords="41,80,181,107"/>
<area shape="rect" href="classroc_1_1core_1_1NonCopyable.html" title="Base class for non&#45;copyable objects." alt="" coords="5,5,216,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae6e1a192ae4bc66da9549267263f0563"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1Profiler.html#ae6e1a192ae4bc66da9549267263f0563">Profiler</a> (<a class="el" href="classroc_1_1core_1_1IArena.html">core::IArena</a> &amp;arena, const <a class="el" href="classroc_1_1audio_1_1SampleSpec.html">audio::SampleSpec</a> &amp;sample_spec, <a class="el" href="structroc_1_1audio_1_1ProfilerConfig.html">ProfilerConfig</a> profiler_config)</td></tr>
<tr class="memdesc:ae6e1a192ae4bc66da9549267263f0563"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialization.  <a href="classroc_1_1audio_1_1Profiler.html#ae6e1a192ae4bc66da9549267263f0563">More...</a><br /></td></tr>
<tr class="separator:ae6e1a192ae4bc66da9549267263f0563"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34e67075b6265ff665f550e1dd58f9cd"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1Profiler.html#a34e67075b6265ff665f550e1dd58f9cd">is_valid</a> () const</td></tr>
<tr class="memdesc:a34e67075b6265ff665f550e1dd58f9cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the profiler was succefully constructed.  <a href="classroc_1_1audio_1_1Profiler.html#a34e67075b6265ff665f550e1dd58f9cd">More...</a><br /></td></tr>
<tr class="separator:a34e67075b6265ff665f550e1dd58f9cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a203de521c5fcecbb72d420c4a8fe2b48"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1Profiler.html#a203de521c5fcecbb72d420c4a8fe2b48">add_frame</a> (size_t frame_size, <a class="el" href="namespaceroc_1_1core.html#ae97845bc2af55cb259b19da6a128d409">core::nanoseconds_t</a> elapsed)</td></tr>
<tr class="memdesc:a203de521c5fcecbb72d420c4a8fe2b48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Profile frame speed.  <a href="classroc_1_1audio_1_1Profiler.html#a203de521c5fcecbb72d420c4a8fe2b48">More...</a><br /></td></tr>
<tr class="separator:a203de521c5fcecbb72d420c4a8fe2b48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6269e7dcebb441bc79addf78cbe22748"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1Profiler.html#a6269e7dcebb441bc79addf78cbe22748">get_moving_avg</a> ()</td></tr>
<tr class="memdesc:a6269e7dcebb441bc79addf78cbe22748"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get computed average.  <a href="classroc_1_1audio_1_1Profiler.html#a6269e7dcebb441bc79addf78cbe22748">More...</a><br /></td></tr>
<tr class="separator:a6269e7dcebb441bc79addf78cbe22748"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classroc_1_1audio_1_1Profiler.html" title="Profiler The role of the profiler is to report the average processing speed (# of samples processed p...">Profiler</a> The role of the profiler is to report the average processing speed (# of samples processed per time unit) during the last N seconds. We want to calculate the average processing speed efficiently (with O(1) complexity, without allocations, and as lightweight as possible). The problems with this are that we have variable-sized frames and SMA requires fixed-size chunks. To efficiently perform this calculation a ring buffer is employed. The idea behind the ring buffer is that each chunk of the buffer is the average speed of 10ms worth of samples. The ring buffer is initialized with fixed size (N * 1000)ms / (10ms) chunks. Within each chunk a weighted mean is used to calculate the average speed during those 10ms. Each frame will contribute a different number of samples to each chunk, the chunk speed is then weighted based on how many samples are contributed at what frame speed. As the chunks get populated the moving average is calculated. When the buffer is not entirely full the cumulative moving average algorithm is used and once the buffer is full the simple moving average algorithm is used. </p>

<p class="definition">Definition at line <a class="el" href="profiler_8h_source.html#l00065">65</a> of file <a class="el" href="profiler_8h_source.html">profiler.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ae6e1a192ae4bc66da9549267263f0563"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6e1a192ae4bc66da9549267263f0563">&#9670;&nbsp;</a></span>Profiler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">roc::audio::Profiler::Profiler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classroc_1_1core_1_1IArena.html">core::IArena</a> &amp;&#160;</td>
          <td class="paramname"><em>arena</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classroc_1_1audio_1_1SampleSpec.html">audio::SampleSpec</a> &amp;&#160;</td>
          <td class="paramname"><em>sample_spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structroc_1_1audio_1_1ProfilerConfig.html">ProfilerConfig</a>&#160;</td>
          <td class="paramname"><em>profiler_config</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialization. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a203de521c5fcecbb72d420c4a8fe2b48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a203de521c5fcecbb72d420c4a8fe2b48">&#9670;&nbsp;</a></span>add_frame()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void roc::audio::Profiler::add_frame </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>frame_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespaceroc_1_1core.html#ae97845bc2af55cb259b19da6a128d409">core::nanoseconds_t</a>&#160;</td>
          <td class="paramname"><em>elapsed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Profile frame speed. </p>

</div>
</div>
<a id="a6269e7dcebb441bc79addf78cbe22748"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6269e7dcebb441bc79addf78cbe22748">&#9670;&nbsp;</a></span>get_moving_avg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float roc::audio::Profiler::get_moving_avg </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get computed average. </p>

</div>
</div>
<a id="a34e67075b6265ff665f550e1dd58f9cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34e67075b6265ff665f550e1dd58f9cd">&#9670;&nbsp;</a></span>is_valid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool roc::audio::Profiler::is_valid </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the profiler was succefully constructed. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>roc_audio/<a class="el" href="profiler_8h_source.html">profiler.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceroc.html">roc</a></li><li class="navelem"><a class="el" href="namespaceroc_1_1audio.html">audio</a></li><li class="navelem"><a class="el" href="classroc_1_1audio_1_1Profiler.html">Profiler</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
