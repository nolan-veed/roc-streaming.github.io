<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Forward Erasure Correction codes &#8212; Roc Toolkit 0.3.0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/nature.css?v=601dbdee" />
    <link rel="stylesheet" type="text/css" href="../_static/roc.css?v=37117d08" />
    <script src="../_static/documentation_options.js?v=e259d695"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/analytics.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Frequency estimator and resampler" href="fe_resampler.html" />
    <link rel="prev" title="Timestamps" href="timestamps.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="fe_resampler.html" title="Frequency estimator and resampler"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="timestamps.html" title="Timestamps"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Roc Toolkit 0.3.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../internals.html" accesskey="U">Internals</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Forward Erasure Correction codes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="forward-erasure-correction-codes">
<h1>Forward Erasure Correction codes<a class="headerlink" href="#forward-erasure-correction-codes" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of contents:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#preface" id="id2">Preface</a></p></li>
<li><p><a class="reference internal" href="#rationale" id="id3">Rationale</a></p></li>
<li><p><a class="reference internal" href="#fecframe" id="id4">FECFRAME</a></p></li>
<li><p><a class="reference internal" href="#fec-packet-fields" id="id5">FEC packet fields</a></p></li>
<li><p><a class="reference internal" href="#fec-on-sender" id="id6">FEC on sender</a></p></li>
<li><p><a class="reference internal" href="#fec-on-receiver" id="id7">FEC on receiver</a></p></li>
</ul>
</nav>
<section id="preface">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Preface</a><a class="headerlink" href="#preface" title="Link to this heading">¶</a></h2>
<p>A network can be relatively reliable (e.g. Ethernet) or unreliable (e.g Wi-Fi or Internet). Unreliable networks require to use some techniques to recover lost data. Two known techniques are sending acknowledgments and retransmitting lost packets (like in TCP), and adding redundancy and then using it to restore lost packets (<a class="reference external" href="https://en.wikipedia.org/wiki/Erasure_code">Forward Erasure Correction codes</a>).</p>
<p>Roc counters packet losses by incorporating several Forward Erasure Correction codes.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Rationale</a><a class="headerlink" href="#rationale" title="Link to this heading">¶</a></h2>
<p>Why not just use TCP? The reason is that TCP can provide you with reliable transport, but can’t guarantee a fixed latency and thus is not suitable for real-time streaming.</p>
<p>For real-time streaming, we usually use RTP, which is a UDP-based protocol. Bare RTP can provide you with a fixed latency, but it doesn’t counter packet losses. At this step erasure detection and correction comes into play. It allows recovering some degree of lost packets while still maintaining a fixed latency.</p>
<p>FEC codes has the following advantages:</p>
<ul class="simple">
<li><p>the probability of packet delivery is increased;</p></li>
<li><p>the latency can still be fixed;</p></li>
</ul>
<p>and the following costs:</p>
<ul class="simple">
<li><p>the latency (jitter buffer size) can not be least than fec block size;</p></li>
<li><p>the traffic is increased (in proportion to the redundancy level).</p></li>
</ul>
</section>
<section id="fecframe">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">FECFRAME</a><a class="headerlink" href="#fecframe" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://tools.ietf.org/html/rfc6363">RFC 6363</a> defines the FEC Framework (FECFRAME), a framework that describes how to use FEC codes with RTP in the network applications. FECFRAME does not provide 100% reliability like TCP does, it just increases the probability that the packet will be delivered, in proportion to the selected redundancy level.</p>
<p>FECFRAME specifies the <a class="reference external" href="https://tools.ietf.org/html/rfc6363#section-5">generic structure</a>
of source and repair packets, grouped into blocks. Source packets contain original data. Repair packets contain redundant data used for recovery. And blocks group the source packets with the corresponding repair packets which are protecting them.</p>
<p>For example, the sender can be configured to add 5 repair packets to every 10 source packets, thus forming blocks of 15 packets. This allows the receiver to recover up to 5 source packets if they get lost or delayed. On the other hand, using 10+5 blocks also requires the latency to be at least 10 packets because when a packet is lost at the beginning of the block, you may need all the remaining packets of this block to be able to recover the lost packet. It also increases the data rate in 1.5 (15/10) times.</p>
<p>FECFRAME doesn’t define protocols and codecs by itself but instead allows different FEC schemes. An FEC scheme defines source and repair packet formats, FEC encoding (building the redundancy data), and decoding (repairing lost data).</p>
<p>Roc implements the FECFRAME specification with several FEC schemes. The packet level is implemented in Roc itself, and the codec level is implemented in <a class="reference external" href="http://openfec.org">OpenFEC library</a>. Currently, it’s highly recommended to use <a class="reference external" href="https://github.com/roc-streaming/openfec">our fork</a> instead of the upstream version since it provides several bug fixes and minor improvements that are not available in the upstream yet.</p>
<p>Roc currently supports the following FEC schemes:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://tools.ietf.org/html/rfc6865">Reed-Solomon</a>, suitable for smaller block sizes and latency (<a class="reference external" href="https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction">Wikipedia</a>);</p></li>
<li><p><a class="reference external" href="https://tools.ietf.org/html/rfc6816">LDPC-Staircase</a>, suitable for larger block sizes and latency.</p></li>
</ul>
<p>FEC scheme implementations are encapsulated by an interface and new schemes can be added easily enough.</p>
</section>
<section id="fec-packet-fields">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">FEC packet fields</a><a class="headerlink" href="#fec-packet-fields" title="Link to this heading">¶</a></h2>
<p>The following fields are present in the source and repair packets:</p>
<ul class="simple">
<li><p>ESI (encoding symbol id) – number of a packet (source or repair) in a block;</p></li>
<li><p>SBN (source block number) – number of a source block in a packet stream;</p></li>
<li><p>SBL (source block length) – number of source packets in a block;</p></li>
<li><p>BLEN (block length), or NEC (number encoding symbols) – number of source and repair packets in a block.</p></li>
</ul>
</section>
<section id="fec-on-sender">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">FEC on sender</a><a class="headerlink" href="#fec-on-sender" title="Link to this heading">¶</a></h2>
<p>The diagram below shows a piece of the sender pipeline responsible for FEC.</p>
<a class="reference internal image-reference" href="../_images/fec_writer_overview.png"><img alt="Writer overview" class="align-center" src="../_images/fec_writer_overview.png" style="width: 800px;" /></a>
<ul class="simple">
<li><p>writer works with the packets flow, cuts this flow into blocks;</p></li>
<li><p>writer passes contents of current block to encoder;</p></li>
<li><p>encoder produces the redundancy data;</p></li>
<li><p>writer builds repair packets from the redundancy data;</p></li>
<li><p>writer adds FEC packet fields to packets;</p></li>
<li><p>writer passes packets to composer;</p></li>
<li><p>composer writes FEC packet fields to the underlying packet payload;</p></li>
<li><p>writer passes packets to the further pipeline components.</p></li>
</ul>
<p>encoder and composer are encapsulated by an interface, implementations are chosen depending on the FEC scheme.</p>
</section>
<section id="fec-on-receiver">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">FEC on receiver</a><a class="headerlink" href="#fec-on-receiver" title="Link to this heading">¶</a></h2>
<p>The diagram below shows a piece of the receiver pipeline responsible for FEC.</p>
<a class="reference internal image-reference" href="../_images/fec_reader_overview.png"><img alt="Reader overview" class="align-center" src="../_images/fec_reader_overview.png" style="width: 650px;" /></a>
<ul class="simple">
<li><p>reader works with the packets flow, cuts this flow into blocks;</p></li>
<li><p>if there are lost packets in the current block:</p>
<ul>
<li><p>reader passes contents of the current block to decoder;</p></li>
<li><p>decoder tries to recover lost packets;</p></li>
<li><p>reader passes the recovered packet data to parser;</p></li>
<li><p>parser builds the packet from the recovered data;</p></li>
</ul>
</li>
<li><p>reader passes packets to the further pipeline components.</p></li>
</ul>
<p>decoder and parser are encapsulated by an interface, implementations are chosen depending on the FEC scheme.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo80.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">Table of Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about_project.html">About project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building.html">Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manuals.html">Manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../portability.html">Portability</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../internals.html">Internals</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_structure.html">Code structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="threads.html">Threads and queues</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipelines.html">Media pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="packets_frames.html">Packets and frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="timestamps.html">Timestamps</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Forward Erasure Correction codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="fe_resampler.html">Frequency estimator and resampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="network_protocols.html">Network protocols</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="fe_resampler.html" title="Frequency estimator and resampler"
             >next</a> |</li>
        <li class="right" >
          <a href="timestamps.html" title="Timestamps"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Roc Toolkit 0.3.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../internals.html" >Internals</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Forward Erasure Correction codes</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Roc Streaming authors.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>